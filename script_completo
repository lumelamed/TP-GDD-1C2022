-- CREAMOS LAS TABLAS ---------------------------------------------------------------------------------------------------------------------
CREATE SCHEMA [COSMICOS]
GO

CREATE TABLE [COSMICOS].[CIRCUITO] (
  [CIRCUITO_CODIGO] int PRIMARY KEY, --importado de tabla maestra
  [CIRCUITO_NOMBRE] nvarchar(255),
  [CIRCUITO_PAIS] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[CARRERA] (
  [CODIGO_CARRERA] int PRIMARY KEY, --importado de tabla maestra
  [CARRERA_FECHA] date,
  [CARRERA_CLIMA] nvarchar(100),
  [CARRERA_TOTAL_CARRERA] decimal(18,2),
  [CARRERA_CANT_VUELTAS] int,
  [CIRCUITO_CODIGO] int NOT NULL
)
GO

CREATE TABLE [COSMICOS].[TIPO_SECTOR] (
  [SECTOR_TIPO] int PRIMARY KEY IDENTITY(1,1), --agregado por nosotros
  [DESCRIPCION] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[SECTOR] (
  [CODIGO_SECTOR] int PRIMARY KEY, --importado de tabla maestra
  [SECTOR_DISTANCIA] decimal(18,2),
  [SECTOR_TIPO] int,
  [CIRCUITO_CODIGO] int NOT NULL
)
GO

CREATE TABLE [COSMICOS].[PILOTO] (
  [CODIGO_PILOTO] int PRIMARY KEY IDENTITY(1,1), --agregado por nosotros
  [PILOTO_NOMBRE] varchar(50),
  [PILOTO_APELLIDO] varchar(50),
  [PILOTO_NACIONALIDAD] varchar(50),
  [PILOTO_FECHA_NACIMIENTO] datetime
)
GO

CREATE TABLE [COSMICOS].[ESCUDERIA] (
  [CODIGO_ESCUDERIA] int PRIMARY KEY IDENTITY(1,1), --agregado por nosotros
  [ESCUDERIA_NOMBRE] varchar(50),
  [ESCUDERIA_NACIONALIDAD] varchar(50)
)
GO

CREATE TABLE [COSMICOS].[MOTOR] (
  [MOTOR_NRO_SERIE] nvarchar(255) PRIMARY KEY, --importado de tabla maestra
  [MOTOR_MODELO] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[CAJA] (
  [CAJA_NRO_SERIE] nvarchar(255) PRIMARY KEY, --importado de tabla maestra
  [CAJA_MODELO] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[FRENO] (
  [FRENO_NRO_SERIE] nvarchar(255) PRIMARY KEY, --importado de tabla maestra
  [FRENO_POSICION] nvarchar(255),
  [FRENO_TAMANIO_DISCO] decimal(18, 2)
)
GO

CREATE TABLE [COSMICOS].[TIPO_NEUMATICO] (
  [NEUMATICO_TIPO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [DESCRIPCION] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[NEUMATICO] (
  [NEUMATICO_NRO_SERIE] nvarchar(255) PRIMARY KEY, --importado de tabla maestra
  [NEUMATICO_POSICION] nvarchar(255),
  [NEUMATICO_TIPO] int
)
GO

CREATE TABLE [COSMICOS].[AUTO] (
  [CODIGO_AUTO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [AUTO_NUMERO] int NOT NULL,
  [AUTO_MODELO] nvarchar(255),
  [CODIGO_PILOTO] int NOT NULL,
  [CODIGO_ESCUDERIA] int NOT NULL,
)
GO

CREATE TABLE [COSMICOS].[AUTO_POR_CARRERA] (
  [CODIGO_AUTO_POR_CARRERA] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [CODIGO_AUTO] int,
  [CODIGO_CARRERA] int,
  [MOTOR_NRO_SERIE] nvarchar(255) NULL,
  [CAJA_NRO_SERIE] nvarchar(255) NULL
)

CREATE TABLE [COSMICOS].[NEUMATICO_POR_AUTO] (
  [CODIGO_NEUMATICO_POR_AUTO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [NEUMATICO_NRO_SERIE] nvarchar(255),
  [CODIGO_AUTO_POR_CARRERA] int,
  [ACTIVO] bit,
)
GO

CREATE TABLE [COSMICOS].[FRENO_POR_AUTO] (
  [CODIGO_FRENO_POR_AUTO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [FRENO_NRO_SERIE] nvarchar(255),
  [CODIGO_AUTO_POR_CARRERA] int NOT NULL,
  [ACTIVO] bit,
)
GO


CREATE TABLE [COSMICOS].[BANDERA] (
  [CODIGO_BANDERA] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [COMPORTAMIENTO] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[TIPO_INCIDENTE] (
  [INCIDENTE_TIPO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [DESCRIPCION] nvarchar(255)
)
GO

CREATE TABLE [COSMICOS].[INCIDENTE] (
  [CODIGO_INCIDENTE] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [CODIGO_CARRERA] int NOT NULL,
  [CODIGO_SECTOR] int NOT NULL,
  [CODIGO_BANDERA] int
)
GO

CREATE TABLE [COSMICOS].[AUTO_POR_INCIDENTE] (
  [CODIGO_AUTO_POR_INCIDENTE] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [CODIGO_INCIDENTE] int NOT NULL,
  [CODIGO_AUTO_POR_CARRERA] int NOT NULL,
  [TIPO_INCIDENTE] int NOT NULL,
  [NRO_VUELTA] decimal(18, 0) NOT NULL,
  [INCIDENTE_TIEMPO] decimal(18, 2)
)
GO

CREATE TABLE [COSMICOS].[PARADA_BOX] (
  [CODIGO_PARADA_BOX] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [CODIGO_CARRERA] int NOT NULL,
  [CODIGO_AUTO_POR_CARRERA] int NOT NULL,
  [PARADA_BOX_VUELTA] decimal(18, 0),
  [PARADA_BOX_TIEMPO] decimal(18, 2)
)
GO

CREATE TABLE [COSMICOS].[NEUMATICO_POR_PARADA] (
  [CODIGO_NEUMATICO_POR_PARADA] int IDENTITY(1, 1), --agregado por nosotros
  [CODIGO_NEUMATICO_POR_AUTO] int,
  [CODIGO_PARADA_BOX] int NOT NULL,
  [TIPO] nvarchar(255) NOT NULL CHECK ([TIPO] IN ('VIEJO', 'NUEVO')),
  PRIMARY KEY ([CODIGO_NEUMATICO_POR_PARADA], [CODIGO_NEUMATICO_POR_AUTO])
)
GO

CREATE TABLE [COSMICOS].[TELEMETRIA_MOTOR] (
  [CODIGO_TELE_MOTOR] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [TELE_MOTOR_NRO_SERIE] nvarchar(255) NOT NULL,
  [TELE_MOTOR_POTENCIA] decimal(18, 6),
  [TELE_MOTOR_TEMP_ACEITE] decimal(18, 6),
  [TELE_MOTOR_TEMP_AGUA] decimal(18, 6),
  [TELE_MOTOR_RPM] decimal(18, 6)
)
GO

CREATE TABLE [COSMICOS].[TELEMETRIA_CAJA] (
  [CODIGO_TELE_CAJA] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [TELE_CAJA_NRO_SERIE] nvarchar(255) NOT NULL,
  [TELE_CAJA_TEMP_ACEITE] decimal(18, 2),
  [TELE_CAJA_RPM] decimal(18, 2),
  [TELE_CAJA_DESGASTE] decimal(18, 2)
)
GO

CREATE TABLE [COSMICOS].[TELEMETRIA_NEUMATICO] (
  [CODIGO_TELE_NEUMATICO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [TELE_NEUMATICO_NRO_SERIE] nvarchar(255) NOT NULL,
  [CODIGO_TELE] int NOT NULL,
  [TELE_NEUMATICO_PRESION] decimal(18, 6),
  [TELE_NEUMATICO_PROFUNDIDAD] decimal(18, 6),
  [TELE_NEUMATICO_TEMPERATURA] decimal(18, 6)
)
GO

CREATE TABLE [COSMICOS].[TELEMETRIA_FRENO] (
  [CODIGO_TELE_FRENO] int PRIMARY KEY IDENTITY(1, 1), --agregado por nosotros
  [TELE_FRENO_NRO_SERIE] nvarchar(255) NOT NULL,
  [CODIGO_TELE] int NOT NULL,
  [TELE_FRENO_TEMPERATURA] decimal(18, 2),
  [TELE_FRENO_GROSOR_PASTILLA] decimal(18, 2)
)
GO

CREATE TABLE [COSMICOS].[TELEMETRIA] (
  [CODIGO_TELE] int PRIMARY KEY, --importado de tabla maestra
  [CODIGO_AUTO_POR_CARRERA] int NOT NULL,
  [CODIGO_CARRERA] int NOT NULL,
  [CODIGO_SECTOR] int NOT NULL,
  [TELE_AUTO_DISTANCIA_CARRERA] decimal(18, 6),
  [TELE_AUTO_DISTANCIA_VUELTA] decimal(18, 2),
  [TELE_AUTO_TIEMPO_VUELTA] decimal(18, 10),
  [TELE_AUTO_POSICION] decimal(18, 0),
  [TELE_AUTO_VELOCIDAD] decimal(18, 2),
  [TELE_AUTO_NUMERO_VUELTA] decimal(18, 0),
  [TELE_AUTO_COMBUSTIBLE] decimal(18, 2),
  [CODIGO_TELE_MOTOR] int NOT NULL,
  [CODIGO_TELE_CAJA] int NOT NULL
)
GO

ALTER TABLE [COSMICOS].[CARRERA] ADD FOREIGN KEY ([CIRCUITO_CODIGO]) REFERENCES [COSMICOS].[CIRCUITO] ([CIRCUITO_CODIGO])
GO

ALTER TABLE [COSMICOS].[SECTOR] ADD FOREIGN KEY ([CIRCUITO_CODIGO]) REFERENCES [COSMICOS].[CIRCUITO] ([CIRCUITO_CODIGO])
GO

ALTER TABLE [COSMICOS].[SECTOR] ADD FOREIGN KEY ([SECTOR_TIPO]) REFERENCES [COSMICOS].[TIPO_SECTOR] ([SECTOR_TIPO])
GO

ALTER TABLE [COSMICOS].[NEUMATICO] ADD FOREIGN KEY ([NEUMATICO_TIPO]) REFERENCES [COSMICOS].[TIPO_NEUMATICO] ([NEUMATICO_TIPO])
GO

ALTER TABLE [COSMICOS].[AUTO] ADD FOREIGN KEY ([CODIGO_PILOTO]) REFERENCES [COSMICOS].[PILOTO] ([CODIGO_PILOTO])
GO

ALTER TABLE [COSMICOS].[AUTO] ADD FOREIGN KEY ([CODIGO_ESCUDERIA]) REFERENCES [COSMICOS].[ESCUDERIA] ([CODIGO_ESCUDERIA])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_CARRERA] ADD FOREIGN KEY ([CODIGO_AUTO]) REFERENCES [COSMICOS].[AUTO] ([CODIGO_AUTO])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_CARRERA] ADD FOREIGN KEY ([CODIGO_CARRERA]) REFERENCES [COSMICOS].[CARRERA] ([CODIGO_CARRERA])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_CARRERA] ADD FOREIGN KEY ([MOTOR_NRO_SERIE]) REFERENCES [COSMICOS].[MOTOR] ([MOTOR_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_CARRERA] ADD FOREIGN KEY ([CAJA_NRO_SERIE]) REFERENCES [COSMICOS].[CAJA] ([CAJA_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[NEUMATICO_POR_AUTO] ADD FOREIGN KEY ([NEUMATICO_NRO_SERIE]) REFERENCES [COSMICOS].[NEUMATICO] ([NEUMATICO_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[NEUMATICO_POR_AUTO] ADD FOREIGN KEY ([CODIGO_AUTO_POR_CARRERA]) REFERENCES [COSMICOS].[AUTO_POR_CARRERA] ([CODIGO_AUTO_POR_CARRERA])
GO

ALTER TABLE [COSMICOS].[FRENO_POR_AUTO] ADD FOREIGN KEY ([FRENO_NRO_SERIE]) REFERENCES [COSMICOS].[FRENO] ([FRENO_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[FRENO_POR_AUTO] ADD FOREIGN KEY ([CODIGO_AUTO_POR_CARRERA]) REFERENCES [COSMICOS].[AUTO_POR_CARRERA] ([CODIGO_AUTO_POR_CARRERA])
GO

ALTER TABLE [COSMICOS].[INCIDENTE] ADD FOREIGN KEY ([CODIGO_CARRERA]) REFERENCES [COSMICOS].[CARRERA] ([CODIGO_CARRERA])
GO

ALTER TABLE [COSMICOS].[INCIDENTE] ADD FOREIGN KEY ([CODIGO_SECTOR]) REFERENCES [COSMICOS].[SECTOR] ([CODIGO_SECTOR])
GO

ALTER TABLE [COSMICOS].[INCIDENTE] ADD FOREIGN KEY ([CODIGO_BANDERA]) REFERENCES [COSMICOS].[BANDERA] ([CODIGO_BANDERA])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_INCIDENTE] ADD FOREIGN KEY ([CODIGO_INCIDENTE]) REFERENCES [COSMICOS].[INCIDENTE] ([CODIGO_INCIDENTE])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_INCIDENTE] ADD FOREIGN KEY ([CODIGO_AUTO_POR_CARRERA]) REFERENCES [COSMICOS].[AUTO_POR_CARRERA] ([CODIGO_AUTO_POR_CARRERA])
GO

ALTER TABLE [COSMICOS].[AUTO_POR_INCIDENTE] ADD FOREIGN KEY ([TIPO_INCIDENTE]) REFERENCES [COSMICOS].[TIPO_INCIDENTE] ([INCIDENTE_TIPO])
GO

ALTER TABLE [COSMICOS].[PARADA_BOX] ADD FOREIGN KEY ([CODIGO_CARRERA]) REFERENCES [COSMICOS].[CARRERA] ([CODIGO_CARRERA])
GO

ALTER TABLE [COSMICOS].[PARADA_BOX] ADD FOREIGN KEY ([CODIGO_AUTO_POR_CARRERA]) REFERENCES [COSMICOS].[AUTO_POR_CARRERA] ([CODIGO_AUTO_POR_CARRERA])
GO

ALTER TABLE [COSMICOS].[NEUMATICO_POR_PARADA] ADD FOREIGN KEY ([CODIGO_NEUMATICO_POR_AUTO]) REFERENCES [COSMICOS].[NEUMATICO_POR_AUTO] ([CODIGO_NEUMATICO_POR_AUTO])
GO

ALTER TABLE [COSMICOS].[NEUMATICO_POR_PARADA] ADD FOREIGN KEY ([CODIGO_PARADA_BOX]) REFERENCES [COSMICOS].[PARADA_BOX] ([CODIGO_PARADA_BOX])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA_MOTOR] ADD FOREIGN KEY ([TELE_MOTOR_NRO_SERIE]) REFERENCES [COSMICOS].[MOTOR] ([MOTOR_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA_CAJA] ADD FOREIGN KEY ([TELE_CAJA_NRO_SERIE]) REFERENCES [COSMICOS].[CAJA] ([CAJA_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA_NEUMATICO] ADD FOREIGN KEY ([TELE_NEUMATICO_NRO_SERIE]) REFERENCES [COSMICOS].[NEUMATICO] ([NEUMATICO_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA_NEUMATICO] ADD FOREIGN KEY ([CODIGO_TELE]) REFERENCES [COSMICOS].[TELEMETRIA] ([CODIGO_TELE])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA_FRENO] ADD FOREIGN KEY ([TELE_FRENO_NRO_SERIE]) REFERENCES [COSMICOS].[FRENO] ([FRENO_NRO_SERIE])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA_FRENO] ADD FOREIGN KEY ([CODIGO_TELE]) REFERENCES [COSMICOS].[TELEMETRIA] ([CODIGO_TELE])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA] ADD FOREIGN KEY ([CODIGO_AUTO_POR_CARRERA]) REFERENCES [COSMICOS].[AUTO_POR_CARRERA] ([CODIGO_AUTO_POR_CARRERA])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA] ADD FOREIGN KEY ([CODIGO_CARRERA]) REFERENCES [COSMICOS].[CARRERA] ([CODIGO_CARRERA])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA] ADD FOREIGN KEY ([CODIGO_SECTOR]) REFERENCES [COSMICOS].[SECTOR] ([CODIGO_SECTOR])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA] ADD FOREIGN KEY ([CODIGO_TELE_MOTOR]) REFERENCES [COSMICOS].[TELEMETRIA_MOTOR] ([CODIGO_TELE_MOTOR])
GO

ALTER TABLE [COSMICOS].[TELEMETRIA] ADD FOREIGN KEY ([CODIGO_TELE_CAJA]) REFERENCES [COSMICOS].[TELEMETRIA_CAJA] ([CODIGO_TELE_CAJA])
GO

--INSERTAMOS LOS DATOS EN LAS TABLAS --------------------------------------------------------------------------------------------------------

-- CIRCUITO
INSERT INTO COSMICOS.CIRCUITO (CIRCUITO_CODIGO, CIRCUITO_NOMBRE, CIRCUITO_PAIS)
SELECT DISTINCT CIRCUITO_CODIGO, CIRCUITO_NOMBRE, CIRCUITO_PAIS 
FROM gd_esquema.Maestra 
ORDER BY CIRCUITO_CODIGO

-- CARRERA
INSERT INTO COSMICOS.CARRERA (CODIGO_CARRERA, CIRCUITO_CODIGO, CARRERA_FECHA, CARRERA_CLIMA, CARRERA_TOTAL_CARRERA, CARRERA_CANT_VUELTAS) 
SELECT DISTINCT CODIGO_CARRERA, CIRCUITO_CODIGO, CARRERA_FECHA, CARRERA_CLIMA, CARRERA_TOTAL_CARRERA, CARRERA_CANT_VUELTAS
FROM gd_esquema.Maestra
ORDER BY CODIGO_CARRERA

--TIPO SECTOR
INSERT INTO COSMICOS.TIPO_SECTOR (DESCRIPCION)
SELECT  DISTINCT  SECTO_TIPO
FROM gd_esquema.Maestra 

--SECTOR
INSERT INTO COSMICOS.SECTOR (CODIGO_SECTOR, SECTOR_DISTANCIA, SECTOR_TIPO, CIRCUITO_CODIGO)
SELECT DISTINCT CODIGO_SECTOR, SECTOR_DISTANCIA, ts.SECTOR_TIPO, CIRCUITO_CODIGO
FROM gd_esquema.Maestra m
JOIN COSMICOS.TIPO_SECTOR ts ON m.SECTO_TIPO = ts.DESCRIPCION
ORDER BY CODIGO_SECTOR

--PILOTO
INSERT INTO COSMICOS.PILOTO 
(PILOTO_NOMBRE, PILOTO_APELLIDO, PILOTO_FECHA_NACIMIENTO, PILOTO_NACIONALIDAD)
SELECT DISTINCT PILOTO_NOMBRE, UPPER(PILOTO_APELLIDO) AS APELLIDO, PILOTO_FECHA_NACIMIENTO, PILOTO_NACIONALIDAD 
FROM gd_esquema.Maestra 
ORDER BY PILOTO_FECHA_NACIMIENTO

-- ESCUDERIA
INSERT INTO COSMICOS.ESCUDERIA 
(ESCUDERIA_NOMBRE, ESCUDERIA_NACIONALIDAD)
SELECT DISTINCT ESCUDERIA_NOMBRE, ESCUDERIA_NACIONALIDAD 
FROM gd_esquema.Maestra 

-- MOTOR
INSERT INTO COSMICOS.MOTOR 
(MOTOR_NRO_SERIE, MOTOR_MODELO)
SELECT DISTINCT TELE_MOTOR_NRO_SERIE, TELE_MOTOR_MODELO 
FROM gd_esquema.Maestra 
WHERE TELE_MOTOR_NRO_SERIE IS NOT NULL

-- CAJA
INSERT INTO COSMICOS.CAJA 
(CAJA_NRO_SERIE, CAJA_MODELO)
SELECT DISTINCT TELE_CAJA_NRO_SERIE, TELE_CAJA_MODELO 
FROM gd_esquema.Maestra 
WHERE TELE_CAJA_NRO_SERIE IS NOT NULL

-- FRENOS
INSERT INTO COSMICOS.FRENO 
(FRENO_NRO_SERIE, FRENO_POSICION, FRENO_TAMANIO_DISCO)
SELECT DISTINCT TELE_FRENO1_NRO_SERIE, TELE_FRENO1_POSICION, TELE_FRENO1_TAMANIO_DISCO 
FROM gd_esquema.Maestra 
WHERE TELE_FRENO1_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_FRENO2_NRO_SERIE, TELE_FRENO2_POSICION, TELE_FRENO2_TAMANIO_DISCO 
FROM gd_esquema.Maestra 
WHERE TELE_FRENO2_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_FRENO3_NRO_SERIE, TELE_FRENO3_POSICION, TELE_FRENO3_TAMANIO_DISCO 
FROM gd_esquema.Maestra 
WHERE TELE_FRENO3_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_FRENO4_NRO_SERIE, TELE_FRENO4_POSICION, TELE_FRENO4_TAMANIO_DISCO 
FROM gd_esquema.Maestra
WHERE TELE_FRENO4_NRO_SERIE IS NOT NULL  

-- TIPO NEUMATICO
INSERT INTO COSMICOS.TIPO_NEUMATICO (DESCRIPCION)
SELECT  DISTINCT  NEUMATICO1_TIPO_NUEVO
FROM gd_esquema.Maestra 
WHERE NEUMATICO1_TIPO_NUEVO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO1_TIPO_VIEJO
FROM gd_esquema.Maestra 
WHERE NEUMATICO1_TIPO_VIEJO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO2_TIPO_NUEVO
FROM gd_esquema.Maestra 
WHERE NEUMATICO2_TIPO_NUEVO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO2_TIPO_VIEJO
FROM gd_esquema.Maestra 
WHERE NEUMATICO2_TIPO_VIEJO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO3_TIPO_NUEVO
FROM gd_esquema.Maestra 
WHERE NEUMATICO3_TIPO_NUEVO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO3_TIPO_VIEJO
FROM gd_esquema.Maestra 
WHERE NEUMATICO3_TIPO_VIEJO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO4_TIPO_NUEVO
FROM gd_esquema.Maestra 
WHERE NEUMATICO4_TIPO_NUEVO IS NOT NULL
UNION
SELECT  DISTINCT  NEUMATICO4_TIPO_VIEJO
FROM gd_esquema.Maestra 
WHERE NEUMATICO4_TIPO_VIEJO IS NOT NULL

-- NEUMATICO
INSERT INTO COSMICOS.NEUMATICO (NEUMATICO_NRO_SERIE, NEUMATICO_POSICION, NEUMATICO_TIPO)
SELECT DISTINCT TELE_NEUMATICO1_NRO_SERIE, TELE_NEUMATICO1_POSICION, tn.NEUMATICO_TIPO
FROM gd_esquema.Maestra m
JOIN COSMICOS.TIPO_NEUMATICO tn ON m.NEUMATICO1_TIPO_NUEVO = tn.DESCRIPCION or  m.NEUMATICO1_TIPO_VIEJO = tn.DESCRIPCION
WHERE TELE_NEUMATICO1_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_NEUMATICO2_NRO_SERIE, TELE_NEUMATICO2_POSICION, tn.NEUMATICO_TIPO
FROM gd_esquema.Maestra m
JOIN COSMICOS.TIPO_NEUMATICO tn ON m.NEUMATICO2_TIPO_NUEVO = tn.DESCRIPCION or  m.NEUMATICO2_TIPO_VIEJO = tn.DESCRIPCION
WHERE TELE_NEUMATICO2_NRO_SERIE IS NOT NULL
UNION 
SELECT DISTINCT TELE_NEUMATICO3_NRO_SERIE, TELE_NEUMATICO3_POSICION, tn.NEUMATICO_TIPO
FROM gd_esquema.Maestra m
JOIN COSMICOS.TIPO_NEUMATICO tn ON m.NEUMATICO3_TIPO_NUEVO = tn.DESCRIPCION or  m.NEUMATICO3_TIPO_VIEJO = tn.DESCRIPCION
WHERE TELE_NEUMATICO3_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_NEUMATICO4_NRO_SERIE, TELE_NEUMATICO4_POSICION, tn.NEUMATICO_TIPO
FROM gd_esquema.Maestra m
JOIN COSMICOS.TIPO_NEUMATICO tn ON m.NEUMATICO4_TIPO_NUEVO = tn.DESCRIPCION or  m.NEUMATICO4_TIPO_VIEJO = tn.DESCRIPCION
WHERE TELE_NEUMATICO4_NRO_SERIE IS NOT NULL
ORDER BY 1

-- AUTO
INSERT INTO COSMICOS.AUTO (AUTO_NUMERO, AUTO_MODELO , CODIGO_PILOTO , CODIGO_ESCUDERIA)
SELECT DISTINCT M.AUTO_NUMERO,M.AUTO_MODELO,P.CODIGO_PILOTO,E.CODIGO_ESCUDERIA
FROM gd_esquema.Maestra AS M
JOIN COSMICOS.PILOTO AS P on P.PILOTO_NOMBRE = M.PILOTO_NOMBRE and P.PILOTO_APELLIDO = UPPER(M.PILOTO_APELLIDO)
JOIN COSMICOS.ESCUDERIA AS E ON E.ESCUDERIA_NOMBRE = M.ESCUDERIA_NOMBRE and E.ESCUDERIA_NACIONALIDAD = M.ESCUDERIA_NACIONALIDAD
ORDER BY E.CODIGO_ESCUDERIA

--AUTO POR CARRERA
INSERT INTO COSMICOS.AUTO_POR_CARRERA (CODIGO_AUTO , CODIGO_CARRERA, CAJA_NRO_SERIE,MOTOR_NRO_SERIE)
SELECT DISTINCT A.CODIGO_AUTO, C.CODIGO_CARRERA, M.TELE_CAJA_NRO_SERIE, M.TELE_MOTOR_NRO_SERIE
FROM gd_esquema.Maestra AS M
JOIN COSMICOS.AUTO A ON A.AUTO_MODELO= M.AUTO_MODELO AND A.AUTO_NUMERO = M.AUTO_NUMERO
JOIN COSMICOS.CARRERA C ON C.CODIGO_CARRERA = M.CODIGO_CARRERA
WHERE M.TELE_CAJA_NRO_SERIE IS NOT NULL and  M.TELE_MOTOR_NRO_SERIE IS NOT NULL
ORDER BY A.CODIGO_AUTO, C.CODIGO_CARRERA

--INCIDENTE
INSERT INTO COSMICOS.INCIDENTE (CODIGO_CARRERA, CODIGO_SECTOR,CODIGO_BANDERA)
SELECT DISTINCT CODIGO_CARRERA,CODIGO_SECTOR, B.CODIGO_BANDERA 
FROM gd_esquema.Maestra M
JOIN COSMICOS.BANDERA AS B ON M.INCIDENTE_BANDERA = B.COMPORTAMIENTO


-- NEUMATICO_POR_AUTO
DECLARE @neu_nro_serie nvarchar(255)
DECLARE CURSOR_NEUMATICOS CURSOR FOR 
SELECT NEUMATICO_NRO_SERIE FROM COSMICOS.NEUMATICO
OPEN CURSOR_NEUMATICOS
FETCH NEXT FROM CURSOR_NEUMATICOS INTO  @neu_nro_serie
    WHILE @@FETCH_STATUS = 0
    BEGIN
		-- VIEJOS, ACTIVO EN 0
		INSERT INTO COSMICOS.NEUMATICO_POR_AUTO (NEUMATICO_NRO_SERIE, CODIGO_AUTO_POR_CARRERA, ACTIVO)
		SELECT DISTINCT @neu_nro_serie, AC.CODIGO_AUTO_POR_CARRERA, 0
		FROM gd_esquema.Maestra m
		JOIN COSMICOS.AUTO a ON m.AUTO_NUMERO = a.AUTO_NUMERO AND m.AUTO_MODELO = a.AUTO_MODELO
		JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA   AND A.CODIGO_AUTO = AC.CODIGO_AUTO
		WHERE (m.NEUMATICO1_NRO_SERIE_VIEJO = @neu_nro_serie OR
				m.NEUMATICO2_NRO_SERIE_VIEJO = @neu_nro_serie OR
				m.NEUMATICO3_NRO_SERIE_VIEJO = @neu_nro_serie OR
				m.NEUMATICO4_NRO_SERIE_VIEJO = @neu_nro_serie)

		-- NUEVOS
		INSERT INTO COSMICOS.NEUMATICO_POR_AUTO (NEUMATICO_NRO_SERIE, CODIGO_AUTO_POR_CARRERA, ACTIVO)
		SELECT DISTINCT @neu_nro_serie, AC.CODIGO_AUTO_POR_CARRERA, (CASE WHEN NOT EXISTS (SELECT * FROM gd_esquema.Maestra m2 -- nunca fue viejo
												WHERE m2.NEUMATICO1_NRO_SERIE_VIEJO = @neu_nro_serie OR
													m2.NEUMATICO2_NRO_SERIE_VIEJO = @neu_nro_serie OR
													m2.NEUMATICO3_NRO_SERIE_VIEJO = @neu_nro_serie OR
													m2.NEUMATICO4_NRO_SERIE_VIEJO = @neu_nro_serie)
										THEN 1 ELSE 0 END)
		FROM gd_esquema.Maestra m
		JOIN COSMICOS.AUTO a ON m.AUTO_NUMERO = a.AUTO_NUMERO AND m.AUTO_MODELO = a.AUTO_MODELO
		JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA   AND A.CODIGO_AUTO = AC.CODIGO_AUTO
		WHERE (m.NEUMATICO1_NRO_SERIE_NUEVO = @neu_nro_serie OR
				m.NEUMATICO2_NRO_SERIE_NUEVO = @neu_nro_serie OR
				m.NEUMATICO3_NRO_SERIE_NUEVO = @neu_nro_serie OR
				m.NEUMATICO4_NRO_SERIE_NUEVO = @neu_nro_serie)
                  
        FETCH NEXT FROM CURSOR_NEUMATICOS INTO @neu_nro_serie
    END
CLOSE CURSOR_NEUMATICOS
DEALLOCATE CURSOR_NEUMATICOS


-- FRENO_POR_AUTO
INSERT INTO COSMICOS.FRENO_POR_AUTO ( FRENO_NRO_SERIE ,  CODIGO_AUTO_POR_CARRERA, ACTIVO)
SELECT DISTINCT TELE_FRENO1_NRO_SERIE, AC.CODIGO_AUTO_POR_CARRERA, 0
FROM gd_esquema.Maestra m
JOIN COSMICOS.AUTO a ON m.AUTO_NUMERO = a.AUTO_NUMERO AND m.AUTO_MODELO = a.AUTO_MODELO
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA AND A.CODIGO_AUTO = AC.CODIGO_AUTO
WHERE TELE_FRENO1_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_FRENO2_NRO_SERIE, AC.CODIGO_AUTO_POR_CARRERA, 0
FROM gd_esquema.Maestra m
JOIN COSMICOS.AUTO a ON m.AUTO_NUMERO = a.AUTO_NUMERO AND m.AUTO_MODELO = a.AUTO_MODELO
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA  AND A.CODIGO_AUTO = AC.CODIGO_AUTO
WHERE TELE_FRENO2_NRO_SERIE IS NOT NULL
UNION
SELECT DISTINCT TELE_FRENO3_NRO_SERIE, AC.CODIGO_AUTO_POR_CARRERA, 0
FROM gd_esquema.Maestra m
JOIN COSMICOS.AUTO a ON m.AUTO_NUMERO = a.AUTO_NUMERO AND m.AUTO_MODELO = a.AUTO_MODELO
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA  AND A.CODIGO_AUTO = AC.CODIGO_AUTO
WHERE TELE_FRENO3_NRO_SERIE IS NOT NULL
UNION 
SELECT DISTINCT TELE_FRENO4_NRO_SERIE, AC.CODIGO_AUTO_POR_CARRERA, 0
FROM gd_esquema.Maestra m
JOIN COSMICOS.AUTO a ON m.AUTO_NUMERO = a.AUTO_NUMERO AND m.AUTO_MODELO = a.AUTO_MODELO
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA  AND A.CODIGO_AUTO = AC.CODIGO_AUTO
WHERE TELE_FRENO4_NRO_SERIE IS NOT NULL
ORDER BY 2

-- Seteamos en 1 los FRENO_POR_AUTO activos 
DECLARE @cod_auto_carrera INT
DECLARE CURSOR_AUTOS_FRENO CURSOR FOR 
	SELECT CODIGO_AUTO_POR_CARRERA FROM COSMICOS.AUTO_POR_CARRERA
    OPEN CURSOR_AUTOS_FRENO
    FETCH NEXT FROM CURSOR_AUTOS_FRENO INTO @cod_auto_carrera
    WHILE @@FETCH_STATUS = 0
    BEGIN
		DECLARE @fre1 nvarchar(255), @fre2 nvarchar(255), @fre3 nvarchar(255), @fre4 nvarchar(255)

		SELECT DISTINCT @fre1 = TELE_FRENO1_NRO_SERIE, 
                        @fre2 = TELE_FRENO2_NRO_SERIE, 
                        @fre3 = TELE_FRENO3_NRO_SERIE, 
                        @fre4 = TELE_FRENO4_NRO_SERIE 
                 FROM [gd_esquema].[Maestra] m
				 JOIN COSMICOS.AUTO A ON M.AUTO_MODELO = A.AUTO_MODELO AND M.AUTO_NUMERO = A.AUTO_NUMERO
				 JOIN COSMICOS.AUTO_POR_CARRERA AC ON A.CODIGO_AUTO = AC.CODIGO_AUTO AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
                 WHERE AC.CODIGO_AUTO_POR_CARRERA = @cod_auto_carrera
                        AND  TELE_FRENO1_NRO_SERIE IS NOT NULL
                        AND  TELE_FRENO2_NRO_SERIE IS NOT NULL
                        AND  TELE_FRENO3_NRO_SERIE IS NOT NULL
                        AND  TELE_FRENO4_NRO_SERIE IS NOT NULL

                  
		UPDATE COSMICOS.FRENO_POR_AUTO
               SET ACTIVO = 1
               WHERE FRENO_NRO_SERIE in (@fre1, @fre2, @fre3, @fre4) AND CODIGO_AUTO_POR_CARRERA = @cod_auto_carrera

        FETCH NEXT FROM CURSOR_AUTOS_FRENO INTO @cod_auto_carrera
	END
CLOSE CURSOR_AUTOS_FRENO
DEALLOCATE CURSOR_AUTOS_FRENO


--AUTO_POR_INCIDENTE
INSERT INTO COSMICOS.AUTO_POR_INCIDENTE (CODIGO_INCIDENTE,CODIGO_AUTO_POR_CARRERA, TIPO_INCIDENTE, NRO_VUELTA, INCIDENTE_TIEMPO)
SELECT CODIGO_INCIDENTE,AC.CODIGO_AUTO_POR_CARRERA, TI.INCIDENTE_TIPO, M.INCIDENTE_NUMERO_VUELTA, M.INCIDENTE_TIEMPO
FROM gd_esquema.Maestra M
JOIN COSMICOS.AUTO A ON M.AUTO_NUMERO = A.AUTO_NUMERO AND M.AUTO_MODELO = A.AUTO_MODELO
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA AND A.CODIGO_AUTO = AC.CODIGO_AUTO
JOIN COSMICOS.TIPO_INCIDENTE TI ON M.INCIDENTE_TIPO = TI.DESCRIPCION
JOIN COSMICOS.INCIDENTE I ON I.CODIGO_CARRERA = M.CODIGO_CARRERA AND I.CODIGO_SECTOR = M.CODIGO_SECTOR
WHERE M.INCIDENTE_TIPO IS NOT NULL
ORDER BY CODIGO_INCIDENTE


--PARADA BOX
INSERT INTO COSMICOS.PARADA_BOX (CODIGO_CARRERA, CODIGO_AUTO_POR_CARRERA, PARADA_BOX_VUELTA, PARADA_BOX_TIEMPO)
SELECT DISTINCT M.CODIGO_CARRERA, AC.CODIGO_AUTO_POR_CARRERA, PARADA_BOX_VUELTA, PARADA_BOX_TIEMPO
FROM gd_esquema.Maestra M
JOIN COSMICOS.AUTO A ON M.AUTO_NUMERO = A.AUTO_NUMERO AND M.AUTO_MODELO = A.AUTO_MODELO
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_CARRERA = M.CODIGO_CARRERA AND A.CODIGO_AUTO = AC.CODIGO_AUTO
WHERE PARADA_BOX_VUELTA IS NOT NULL
ORDER BY CODIGO_CARRERA, PARADA_BOX_VUELTA
  
    
-- TIPO INCIDENTE
INSERT INTO COSMICOS.TIPO_INCIDENTE
SELECT DISTINCT INCIDENTE_TIPO FROM gd_esquema.Maestra WHERE INCIDENTE_TIPO IS NOT NULL

-- BANDERA
INSERT INTO COSMICOS.BANDERA
SELECT DISTINCT INCIDENTE_BANDERA FROM gd_esquema.Maestra WHERE INCIDENTE_BANDERA IS NOT NULL


--NEUMATICO POR PARADA
INSERT INTO COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'NUEVO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO1_NRO_SERIE_NUEVO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'VIEJO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO1_NRO_SERIE_VIEJO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'NUEVO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO2_NRO_SERIE_NUEVO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'VIEJO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO2_NRO_SERIE_VIEJO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'NUEVO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO3_NRO_SERIE_NUEVO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'VIEJO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO3_NRO_SERIE_VIEJO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'NUEVO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO4_NRO_SERIE_NUEVO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX

INSERT INTO  COSMICOS.NEUMATICO_POR_PARADA (CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, TIPO)
SELECT DISTINCT CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX, 'VIEJO'
FROM gd_esquema.Maestra m
	JOIN COSMICOS.NEUMATICO_POR_AUTO npa ON m.NEUMATICO4_NRO_SERIE_VIEJO = npa.NEUMATICO_NRO_SERIE
	JOIN COSMICOS.PARADA_BOX pb ON m.PARADA_BOX_TIEMPO = pb.PARADA_BOX_TIEMPO AND m.PARADA_BOX_VUELTA = pb.PARADA_BOX_VUELTA
ORDER BY CODIGO_NEUMATICO_POR_AUTO, CODIGO_PARADA_BOX


-- TELEMETRIA MOTOR
INSERT INTO COSMICOS.TELEMETRIA_MOTOR (TELE_MOTOR_NRO_SERIE, TELE_MOTOR_POTENCIA, TELE_MOTOR_TEMP_ACEITE, TELE_MOTOR_TEMP_AGUA, TELE_MOTOR_RPM)
SELECT DISTINCT TELE_MOTOR_NRO_SERIE, TELE_MOTOR_POTENCIA, TELE_MOTOR_TEMP_ACEITE, TELE_MOTOR_TEMP_AGUA, TELE_MOTOR_RPM 
from gd_esquema.Maestra
WHERE TELE_MOTOR_NRO_SERIE IS NOT NULL


--TELEMETRIA_CAJA 
INSERT INTO COSMICOS.TELEMETRIA_CAJA (TELE_CAJA_NRO_SERIE, TELE_CAJA_TEMP_ACEITE, TELE_CAJA_RPM, TELE_CAJA_DESGASTE)
SELECT DISTINCT TELE_CAJA_NRO_SERIE, TELE_CAJA_TEMP_ACEITE, TELE_CAJA_RPM, TELE_CAJA_DESGASTE 
from gd_esquema.Maestra
WHERE TELE_CAJA_NRO_SERIE IS NOT NULL


-- TELEMETRIA
INSERT INTO COSMICOS.TELEMETRIA (CODIGO_TELE, CODIGO_AUTO_POR_CARRERA, CODIGO_CARRERA, CODIGO_SECTOR,
TELE_AUTO_DISTANCIA_CARRERA, TELE_AUTO_DISTANCIA_VUELTA, TELE_AUTO_TIEMPO_VUELTA, TELE_AUTO_POSICION, TELE_AUTO_VELOCIDAD, 
TELE_AUTO_NUMERO_VUELTA, TELE_AUTO_COMBUSTIBLE, CODIGO_TELE_MOTOR, CODIGO_TELE_CAJA)
SELECT DISTINCT TELE_AUTO_CODIGO, AC.CODIGO_AUTO_POR_CARRERA, M.CODIGO_CARRERA, CODIGO_SECTOR, 
TELE_AUTO_DISTANCIA_CARRERA, TELE_AUTO_DISTANCIA_VUELTA, TELE_AUTO_TIEMPO_VUELTA, TELE_AUTO_POSICION, TELE_AUTO_VELOCIDAD,
TELE_AUTO_NUMERO_VUELTA, TELE_AUTO_COMBUSTIBLE, TM.CODIGO_TELE_MOTOR, TC.CODIGO_TELE_CAJA
from gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA_CAJA TC ON M.TELE_CAJA_NRO_SERIE = TC.TELE_CAJA_NRO_SERIE 
		AND M.TELE_CAJA_TEMP_ACEITE = TC.TELE_CAJA_TEMP_ACEITE AND M.TELE_CAJA_RPM = TC.TELE_CAJA_RPM 
		AND M.TELE_CAJA_DESGASTE = TC.TELE_CAJA_DESGASTE
JOIN COSMICOS.TELEMETRIA_MOTOR  TM ON M.TELE_MOTOR_NRO_SERIE = TM.TELE_MOTOR_NRO_SERIE 
		AND M.TELE_MOTOR_POTENCIA = TM.TELE_MOTOR_POTENCIA AND M.TELE_MOTOR_TEMP_ACEITE = TM.TELE_MOTOR_TEMP_ACEITE
		AND M.TELE_MOTOR_TEMP_AGUA = TM.TELE_MOTOR_TEMP_AGUA AND M.TELE_MOTOR_RPM = TM.TELE_MOTOR_RPM
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
		AND AC.MOTOR_NRO_SERIE = M.TELE_MOTOR_NRO_SERIE
		AND AC.CAJA_NRO_SERIE = M.TELE_CAJA_NRO_SERIE
ORDER BY TELE_AUTO_CODIGO
 

 -- TELEMETRIA FRENO
INSERT INTO COSMICOS.TELEMETRIA_FRENO (TELE_FRENO_NRO_SERIE, TELE_FRENO_GROSOR_PASTILLA, TELE_FRENO_TEMPERATURA, CODIGO_TELE)
SELECT TELE_FRENO1_NRO_SERIE, TELE_FRENO1_GROSOR_PASTILLA, TELE_FRENO1_TEMPERATURA, T.CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
UNION
SELECT TELE_FRENO2_NRO_SERIE, TELE_FRENO2_GROSOR_PASTILLA, TELE_FRENO2_TEMPERATURA, T.CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON  T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
UNION
SELECT TELE_FRENO3_NRO_SERIE, TELE_FRENO3_GROSOR_PASTILLA, TELE_FRENO3_TEMPERATURA, T.CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON  T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
UNION
SELECT TELE_FRENO4_NRO_SERIE, TELE_FRENO4_GROSOR_PASTILLA, TELE_FRENO4_TEMPERATURA, T.CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON  T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
ORDER BY 4 



-- TELEMETRIA NEUMATICO
INSERT COSMICOS.TELEMETRIA_NEUMATICO (TELE_NEUMATICO_NRO_SERIE, TELE_NEUMATICO_PRESION, TELE_NEUMATICO_PROFUNDIDAD, TELE_NEUMATICO_TEMPERATURA, CODIGO_TELE)
SELECT TELE_NEUMATICO1_NRO_SERIE, TELE_NEUMATICO1_PRESION, TELE_NEUMATICO1_PROFUNDIDAD, TELE_NEUMATICO1_TEMPERATURA, CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
UNION
SELECT TELE_NEUMATICO2_NRO_SERIE, TELE_NEUMATICO2_PRESION, TELE_NEUMATICO2_PROFUNDIDAD, TELE_NEUMATICO2_TEMPERATURA, CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
UNION
SELECT TELE_NEUMATICO3_NRO_SERIE, TELE_NEUMATICO3_PRESION, TELE_NEUMATICO3_PROFUNDIDAD, TELE_NEUMATICO3_TEMPERATURA, CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
UNION
SELECT TELE_NEUMATICO4_NRO_SERIE, TELE_NEUMATICO4_PRESION, TELE_NEUMATICO4_PROFUNDIDAD, TELE_NEUMATICO4_TEMPERATURA, CODIGO_TELE
FROM gd_esquema.Maestra M
JOIN COSMICOS.TELEMETRIA T ON T.TELE_AUTO_DISTANCIA_CARRERA = M.TELE_AUTO_DISTANCIA_CARRERA 
	AND T.TELE_AUTO_DISTANCIA_VUELTA = M.TELE_AUTO_DISTANCIA_VUELTA
	AND T.TELE_AUTO_POSICION = M.TELE_AUTO_POSICION
	AND T.TELE_AUTO_TIEMPO_VUELTA = M.TELE_AUTO_TIEMPO_VUELTA
	AND T.TELE_AUTO_VELOCIDAD  = M.TELE_AUTO_VELOCIDAD
	AND T.TELE_AUTO_COMBUSTIBLE = M.TELE_AUTO_COMBUSTIBLE
JOIN COSMICOS.AUTO AU ON AU.AUTO_MODELO = M.AUTO_MODELO AND AU.AUTO_NUMERO = M.AUTO_NUMERO 
JOIN COSMICOS.AUTO_POR_CARRERA AC ON AC.CODIGO_AUTO = AU.CODIGO_AUTO 
	AND M.CODIGO_CARRERA = AC.CODIGO_CARRERA
	AND T.CODIGO_AUTO_POR_CARRERA = AC.CODIGO_AUTO_POR_CARRERA
ORDER BY 5
